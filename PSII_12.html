<!DOCTYPE html>
<html>

<head>
 <meta charset="utf-8">
 <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
 <title>PSII_12</title>
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.16/dist/katex.min.css" integrity="sha384-6LkG2wmY8FK9E0vU9OOr8UvLwsaqUg9SETfpq4uTCN1agNe8HRdE9ABlk+fVx6gZ" crossorigin="anonymous">
 <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.16/dist/katex.min.js" integrity="sha384-31El76TwmbHj4rF9DyLsygbq6xoIobG0W+jqXim+a3dU9W53tdH3A/ngRPxOzzaB" crossorigin="anonymous"></script>
 <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.16/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"></script>
 <script>
   document.addEventListener("DOMContentLoaded", function() {
     renderMathInElement(document.body, {delimiters: [
       {left: "\\[", right: "\\]", display: true},
       {left: "$", right: "$", display: false}
     ]});
   });
   </script>
 <script>
   document.addEventListener("DOMContentLoaded", function() {
       setTimeout(function() { 
           renderMathInElement(document.body, {delimiters: [
       {left: "\\[", right: "\\]", display: true},
       {left: "$", right: "$", display: false}
     ]});
           },100)
   });
   </script>
   
<style>
    .box {
        border: blue 1px solid; /*境界線の指定*/
        padding:10px;
        }
        .box p {
        margin:0;
        padding:0;
        }
    </style>
    

<script>
    let num_of_data = Math.floor(Math.random()*3 + 5);
    let data = [];
    for(let i=0; i<num_of_data; i++){
        let tmp = 0;
        tmp = Math.floor((Math.random()*40+230))/10;
//        tmp = Math.floor(tmp/2)/10;
        data.push(tmp);
    }
    console.log(data);

    let data_in_text = "$";
    for(let i=0; i<num_of_data; i++){
        data_in_text += data[i] + ", \\quad";
    }
    data_in_text = data_in_text.slice(0, -7);
    data_in_text += "$"
    let conf_coef_list = [90, 95, 99];
    let conf_coef_seed = Math.floor(Math.random()*3)
    let conf_coef = conf_coef_list[conf_coef_seed];
    //
    let alpha_point_lower_list = [[0.7107, 0.4844, 0.2070], [1.1455, 0.8312, 0.4117], [1.6354, 1.2373, 0.6757]]; //0→自由度4, 1→自由度5, 2→自由度6
    let alpha_point_lower = alpha_point_lower_list[num_of_data-5][conf_coef_seed];
    let alpha_point_upper_list = [[9.4877, 11.1433, 14.8603], [11.0705, 12.8325, 16.7496], [12.5916, 14.4494, 18.5476]]; //0→自由度4, 1→自由度5, 2→自由度6
    let alpha_point_upper = alpha_point_upper_list[num_of_data-5][conf_coef_seed];

    let both_sides = Math.round((100 - conf_coef)*5)/10;

    let ave = average(data);
    ave = Math.round(ave*100000000)/100000000;

    let data_square = [];
    for(let i=0; i<num_of_data; i++){
        data_square.push(data[i]**2);
    }
    let variance = average(data_square) - average(data)**2;
    variance = Math.round(variance*100000000)/100000000;

    let pop_var_lower = num_of_data*variance / alpha_point_upper;
    let pop_var_lower_app = Math.round(pop_var_lower*100)/100;
    let pop_var_upper = num_of_data*variance / alpha_point_lower;
    let pop_var_upper_app = Math.round(pop_var_upper*100)/100;

    /////////////////////////////////////////

    function average(array){
        let n = array.length;
        let result = 0;
        for(let i=0; i<n; i++){
            result += array[i];
        }
        result /= n;
        return result;
    }

    function expectation(array_var, array_prob){
        let result = 0;
        for(let i=0; i<array_var.length; i++){
            result += array_var[i]*array_prob[i];
        }
        return result;
    }

    function dnorm(x){
        return Math.exp((-1)*(x**2)/2) / Math.sqrt(2*Math.PI);
    }

    function pnorm(x) {
        // constants
        var p  =  0.2316419;
        var b1 =  0.31938153;
        var b2 = -0.356563782;
        var b3 =  1.781477937;
        var b4 = -1.821255978;
        var b5 =  1.330274429;
        var t = 1 / (1 + p * Math.abs(x));
        var Z = Math.exp(-x * x / 2) / Math.sqrt(2 * Math.PI);
        var y = 1 - Z * ((((b5 * t + b4) * t + b3) * t + b2) * t + b1) * t;
        return (x > 0) ? y : 1 - y;
    }

    function generate_quizzes(){
        document.getElementById("q1_id").textContent = "$" + num_of_data + "$";
        document.getElementById("q2_id").textContent = data_in_text;
        document.getElementById("q3_id").textContent = "$" + conf_coef + "\\% $";
        document.getElementById("q5_id").textContent = "$ \\frac{" + num_of_data + "S^2}{\\sigma^2} $";
        document.getElementById("q6_id").textContent = "$" + (num_of_data - 1) + "$";
        document.getElementById("q7_id").textContent = "$ \\chi_" + (num_of_data - 1) + "^2 $";
        document.getElementById("q8_id").textContent = "$ \\chi_" + (num_of_data - 1) + "^2 $";
        document.getElementById("q9_id").textContent = "$" + both_sides + "\\% $";
        document.getElementById("q10_id").textContent = "$" + both_sides + "\\% $";
        document.getElementById("q11_id").textContent = "$" + alpha_point_lower + ", \\, " + alpha_point_upper + "$";
        //document.getElementById("q12_id").textContent = "$ \\bar{x} =" + ave + "$";
        document.getElementById("q13_id").textContent = "$ s^2 =" + variance + "$";
        document.getElementById("q14_id").textContent = "\\[ " + alpha_point_lower + "\\leq \\frac{" + num_of_data + "\\times "+ variance + "}{ \\sigma^2 } \\leq" + alpha_point_upper + "\\]";
        document.getElementById("q15_id").textContent = "$" + conf_coef + "\\% $";
        document.getElementById("q16_id").textContent = "\\[" + pop_var_lower_app + "\\leq \\sigma^2 \\leq" + pop_var_upper_app + "\\]";
        /*
        document.getElementById("q9_id").textContent = "$ \\bar{x} =" + sample_mean + "$";
        document.getElementById("q10_id").textContent = "\\[ -" + alpha_point + "\\leq \\frac{" + sample_mean + "- \\mu}{" + pop_variance + "/ \\sqrt{" + num_of_samples + "}} \\leq" + alpha_point + "\\]";
        document.getElementById("q11_id").textContent = "$" + conf_coef + "\\% $";
        document.getElementById("q12_id").textContent = "\\[" + pop_mean_lower_app + "\\leq \\mu \\leq" + pop_mean_upper_app + "\\]";
        */

        /*
        document.getElementById("a1_id").textContent = a1;
        document.getElementById("a2_id").textContent = a2;
        */
    }

    function show_answer(e){
        let identifier = e.id;
        document.getElementById("a"+identifier).style.color = "red";
    }
</script>
</head>

<body onload="generate_quizzes()">
 <center>
    <h1>母分散の区間推定</h1>
    必要であれば一般電卓を使用してよい。<br>　<br>
    <div class="box">
        [ Tips ] <br>
        正規分布 $N(\mu, \sigma^2)$ から無作為標本 $X_1, \dots, X_n$ をとる。このとき<br>
        \[ \sum_{i=1}^n \left( \frac{X_i - \overline{X}}{\sigma} \right)^2 \]
        は自由度 $n-1$ のカイ2乗分布 $\chi^2_{n-1}$ に従う。
        この式を変形すると
        \[ \frac{1}{\sigma^2}\sum_{i=1}^n (X_i - \overline{X})^2
        = \frac{n}{\sigma^2} S^2
        = \frac{n-1}{\sigma^2} U^2 \]
        となる。ただし、$S^2$ は標本分散、$U^2$ は不偏分散を表す。母分散の推定は
        \[ \frac{n}{\sigma^2} S^2 \sim \chi^2_{n-1} \text{　{\footnotesize もしくは}　} \frac{n-1}{\sigma^2} U^2 \sim \chi^2_{n-1} \]
        のうち好きな方を用いて行う。
        </div>
 </center>
 <br>　<br>
 正規母集団から <span id="q1_id"></span> 個の標本を抽出して次のデータを得た。<br>
 　　 <span id="q2_id"></span> <br>
 母分散 $\sigma^2$ の <span id="q3_id"></span> 信頼区間を求めよ。<br>
 区間の両端の数値が割り切れない場合は小数第2位まで答えよ（小数第3位を四捨五入せよ）。　　<button id="1_id" onclick="show_answer(this)">答え</button>
 <br> <br>

 <sapn id="a1_id" style="color:white">
 [解答] <br>
 問題文から <span id="q5_id"></span> が自由度 <span id="q6_id"></span> のカイ2乗分布 <span id="q7_id"></span> に従う。 <br>
 <span id="q8_id"></span> の下側 <span id="q9_id"></span> 点と上側 <span id="q10_id"></span> 点はそれぞれ <span id="q11_id"></span> であり、 <br>
 標本分散が <span id="q13_id"></span> だから 
 <span id="q14_id"></span>
 である。これを $\sigma^2$ について解いて母分散の <span id="q15_id"></span> 信頼区間
 <span id="q16_id"></span>
 を得る。
 </sapn> 
 <br> <br>
</body>
</html>
